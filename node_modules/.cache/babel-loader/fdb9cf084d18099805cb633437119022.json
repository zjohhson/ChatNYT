{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst RuntimeGlobals = require(\"../RuntimeGlobals\");\n\nconst RuntimeModule = require(\"../RuntimeModule\");\n\nconst SelfModuleFactory = require(\"../SelfModuleFactory\");\n\nconst Template = require(\"../Template\");\n\nconst CommonJsExportsDependency = require(\"./CommonJsExportsDependency\");\n\nconst CommonJsFullRequireDependency = require(\"./CommonJsFullRequireDependency\");\n\nconst CommonJsRequireContextDependency = require(\"./CommonJsRequireContextDependency\");\n\nconst CommonJsRequireDependency = require(\"./CommonJsRequireDependency\");\n\nconst CommonJsSelfReferenceDependency = require(\"./CommonJsSelfReferenceDependency\");\n\nconst ModuleDecoratorDependency = require(\"./ModuleDecoratorDependency\");\n\nconst RequireHeaderDependency = require(\"./RequireHeaderDependency\");\n\nconst RequireResolveContextDependency = require(\"./RequireResolveContextDependency\");\n\nconst RequireResolveDependency = require(\"./RequireResolveDependency\");\n\nconst RequireResolveHeaderDependency = require(\"./RequireResolveHeaderDependency\");\n\nconst RuntimeRequirementsDependency = require(\"./RuntimeRequirementsDependency\");\n\nconst CommonJsExportsParserPlugin = require(\"./CommonJsExportsParserPlugin\");\n\nconst CommonJsImportsParserPlugin = require(\"./CommonJsImportsParserPlugin\");\n\nconst {\n  JAVASCRIPT_MODULE_TYPE_AUTO,\n  JAVASCRIPT_MODULE_TYPE_DYNAMIC\n} = require(\"../ModuleTypeConstants\");\n\nconst {\n  evaluateToIdentifier,\n  toConstantDependency\n} = require(\"../javascript/JavascriptParserHelpers\");\n\nconst CommonJsExportRequireDependency = require(\"./CommonJsExportRequireDependency\");\n/** @typedef {import(\"../../declarations/WebpackOptions\").JavascriptParserOptions} JavascriptParserOptions */\n\n/** @typedef {import(\"../Compilation\")} Compilation */\n\n/** @typedef {import(\"../Compiler\")} Compiler */\n\n/** @typedef {import(\"../Dependency\").DependencyLocation} DependencyLocation */\n\n/** @typedef {import(\"../Module\").BuildInfo} BuildInfo */\n\n/** @typedef {import(\"../javascript/JavascriptParser\")} Parser */\n\n\nconst PLUGIN_NAME = \"CommonJsPlugin\";\n\nclass CommonJsPlugin {\n  /**\n   * Apply the plugin\n   * @param {Compiler} compiler the compiler instance\n   * @returns {void}\n   */\n  apply(compiler) {\n    compiler.hooks.compilation.tap(PLUGIN_NAME, (compilation, _ref) => {\n      let {\n        contextModuleFactory,\n        normalModuleFactory\n      } = _ref;\n      compilation.dependencyFactories.set(CommonJsRequireDependency, normalModuleFactory);\n      compilation.dependencyTemplates.set(CommonJsRequireDependency, new CommonJsRequireDependency.Template());\n      compilation.dependencyFactories.set(CommonJsFullRequireDependency, normalModuleFactory);\n      compilation.dependencyTemplates.set(CommonJsFullRequireDependency, new CommonJsFullRequireDependency.Template());\n      compilation.dependencyFactories.set(CommonJsRequireContextDependency, contextModuleFactory);\n      compilation.dependencyTemplates.set(CommonJsRequireContextDependency, new CommonJsRequireContextDependency.Template());\n      compilation.dependencyFactories.set(RequireResolveDependency, normalModuleFactory);\n      compilation.dependencyTemplates.set(RequireResolveDependency, new RequireResolveDependency.Template());\n      compilation.dependencyFactories.set(RequireResolveContextDependency, contextModuleFactory);\n      compilation.dependencyTemplates.set(RequireResolveContextDependency, new RequireResolveContextDependency.Template());\n      compilation.dependencyTemplates.set(RequireResolveHeaderDependency, new RequireResolveHeaderDependency.Template());\n      compilation.dependencyTemplates.set(RequireHeaderDependency, new RequireHeaderDependency.Template());\n      compilation.dependencyTemplates.set(CommonJsExportsDependency, new CommonJsExportsDependency.Template());\n      compilation.dependencyFactories.set(CommonJsExportRequireDependency, normalModuleFactory);\n      compilation.dependencyTemplates.set(CommonJsExportRequireDependency, new CommonJsExportRequireDependency.Template());\n      const selfFactory = new SelfModuleFactory(compilation.moduleGraph);\n      compilation.dependencyFactories.set(CommonJsSelfReferenceDependency, selfFactory);\n      compilation.dependencyTemplates.set(CommonJsSelfReferenceDependency, new CommonJsSelfReferenceDependency.Template());\n      compilation.dependencyFactories.set(ModuleDecoratorDependency, selfFactory);\n      compilation.dependencyTemplates.set(ModuleDecoratorDependency, new ModuleDecoratorDependency.Template());\n      compilation.hooks.runtimeRequirementInModule.for(RuntimeGlobals.harmonyModuleDecorator).tap(PLUGIN_NAME, (module, set) => {\n        set.add(RuntimeGlobals.module);\n        set.add(RuntimeGlobals.requireScope);\n      });\n      compilation.hooks.runtimeRequirementInModule.for(RuntimeGlobals.nodeModuleDecorator).tap(PLUGIN_NAME, (module, set) => {\n        set.add(RuntimeGlobals.module);\n        set.add(RuntimeGlobals.requireScope);\n      });\n      compilation.hooks.runtimeRequirementInTree.for(RuntimeGlobals.harmonyModuleDecorator).tap(PLUGIN_NAME, (chunk, set) => {\n        compilation.addRuntimeModule(chunk, new HarmonyModuleDecoratorRuntimeModule());\n      });\n      compilation.hooks.runtimeRequirementInTree.for(RuntimeGlobals.nodeModuleDecorator).tap(PLUGIN_NAME, (chunk, set) => {\n        compilation.addRuntimeModule(chunk, new NodeModuleDecoratorRuntimeModule());\n      });\n      /**\n       * @param {Parser} parser parser parser\n       * @param {JavascriptParserOptions} parserOptions parserOptions\n       * @returns {void}\n       */\n\n      const handler = (parser, parserOptions) => {\n        if (parserOptions.commonjs !== undefined && !parserOptions.commonjs) return;\n        parser.hooks.typeof.for(\"module\").tap(PLUGIN_NAME, toConstantDependency(parser, JSON.stringify(\"object\")));\n        parser.hooks.expression.for(\"require.main\").tap(PLUGIN_NAME, toConstantDependency(parser, `${RuntimeGlobals.moduleCache}[${RuntimeGlobals.entryModuleId}]`, [RuntimeGlobals.moduleCache, RuntimeGlobals.entryModuleId]));\n        parser.hooks.expression.for(RuntimeGlobals.moduleLoaded).tap(PLUGIN_NAME, expr => {\n          /** @type {BuildInfo} */\n          parser.state.module.buildInfo.moduleConcatenationBailout = RuntimeGlobals.moduleLoaded;\n          const dep = new RuntimeRequirementsDependency([RuntimeGlobals.moduleLoaded]);\n          dep.loc =\n          /** @type {DependencyLocation} */\n          expr.loc;\n          parser.state.module.addPresentationalDependency(dep);\n          return true;\n        });\n        parser.hooks.expression.for(RuntimeGlobals.moduleId).tap(PLUGIN_NAME, expr => {\n          /** @type {BuildInfo} */\n          parser.state.module.buildInfo.moduleConcatenationBailout = RuntimeGlobals.moduleId;\n          const dep = new RuntimeRequirementsDependency([RuntimeGlobals.moduleId]);\n          dep.loc =\n          /** @type {DependencyLocation} */\n          expr.loc;\n          parser.state.module.addPresentationalDependency(dep);\n          return true;\n        });\n        parser.hooks.evaluateIdentifier.for(\"module.hot\").tap(PLUGIN_NAME, evaluateToIdentifier(\"module.hot\", \"module\", () => [\"hot\"], null));\n        new CommonJsImportsParserPlugin(parserOptions).apply(parser);\n        new CommonJsExportsParserPlugin(compilation.moduleGraph).apply(parser);\n      };\n\n      normalModuleFactory.hooks.parser.for(JAVASCRIPT_MODULE_TYPE_AUTO).tap(PLUGIN_NAME, handler);\n      normalModuleFactory.hooks.parser.for(JAVASCRIPT_MODULE_TYPE_DYNAMIC).tap(PLUGIN_NAME, handler);\n    });\n  }\n\n}\n\nclass HarmonyModuleDecoratorRuntimeModule extends RuntimeModule {\n  constructor() {\n    super(\"harmony module decorator\");\n  }\n  /**\n   * @returns {string | null} runtime code\n   */\n\n\n  generate() {\n    const {\n      runtimeTemplate\n    } =\n    /** @type {Compilation} */\n    this.compilation;\n    return Template.asString([`${RuntimeGlobals.harmonyModuleDecorator} = ${runtimeTemplate.basicFunction(\"module\", [\"module = Object.create(module);\", \"if (!module.children) module.children = [];\", \"Object.defineProperty(module, 'exports', {\", Template.indent([\"enumerable: true,\", `set: ${runtimeTemplate.basicFunction(\"\", [\"throw new Error('ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: ' + module.id);\"])}`]), \"});\", \"return module;\"])};`]);\n  }\n\n}\n\nclass NodeModuleDecoratorRuntimeModule extends RuntimeModule {\n  constructor() {\n    super(\"node module decorator\");\n  }\n  /**\n   * @returns {string | null} runtime code\n   */\n\n\n  generate() {\n    const {\n      runtimeTemplate\n    } =\n    /** @type {Compilation} */\n    this.compilation;\n    return Template.asString([`${RuntimeGlobals.nodeModuleDecorator} = ${runtimeTemplate.basicFunction(\"module\", [\"module.paths = [];\", \"if (!module.children) module.children = [];\", \"return module;\"])};`]);\n  }\n\n}\n\nmodule.exports = CommonJsPlugin;","map":{"version":3,"sources":["/Users/zachjohnson/Desktop/ChatNYT/node_modules/webpack/lib/dependencies/CommonJsPlugin.js"],"names":["RuntimeGlobals","require","RuntimeModule","SelfModuleFactory","Template","CommonJsExportsDependency","CommonJsFullRequireDependency","CommonJsRequireContextDependency","CommonJsRequireDependency","CommonJsSelfReferenceDependency","ModuleDecoratorDependency","RequireHeaderDependency","RequireResolveContextDependency","RequireResolveDependency","RequireResolveHeaderDependency","RuntimeRequirementsDependency","CommonJsExportsParserPlugin","CommonJsImportsParserPlugin","JAVASCRIPT_MODULE_TYPE_AUTO","JAVASCRIPT_MODULE_TYPE_DYNAMIC","evaluateToIdentifier","toConstantDependency","CommonJsExportRequireDependency","PLUGIN_NAME","CommonJsPlugin","apply","compiler","hooks","compilation","tap","contextModuleFactory","normalModuleFactory","dependencyFactories","set","dependencyTemplates","selfFactory","moduleGraph","runtimeRequirementInModule","for","harmonyModuleDecorator","module","add","requireScope","nodeModuleDecorator","runtimeRequirementInTree","chunk","addRuntimeModule","HarmonyModuleDecoratorRuntimeModule","NodeModuleDecoratorRuntimeModule","handler","parser","parserOptions","commonjs","undefined","typeof","JSON","stringify","expression","moduleCache","entryModuleId","moduleLoaded","expr","state","buildInfo","moduleConcatenationBailout","dep","loc","addPresentationalDependency","moduleId","evaluateIdentifier","constructor","generate","runtimeTemplate","asString","basicFunction","indent","exports"],"mappings":"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","sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\n\"use strict\";\n\nconst RuntimeGlobals = require(\"../RuntimeGlobals\");\nconst RuntimeModule = require(\"../RuntimeModule\");\nconst SelfModuleFactory = require(\"../SelfModuleFactory\");\nconst Template = require(\"../Template\");\nconst CommonJsExportsDependency = require(\"./CommonJsExportsDependency\");\nconst CommonJsFullRequireDependency = require(\"./CommonJsFullRequireDependency\");\nconst CommonJsRequireContextDependency = require(\"./CommonJsRequireContextDependency\");\nconst CommonJsRequireDependency = require(\"./CommonJsRequireDependency\");\nconst CommonJsSelfReferenceDependency = require(\"./CommonJsSelfReferenceDependency\");\nconst ModuleDecoratorDependency = require(\"./ModuleDecoratorDependency\");\nconst RequireHeaderDependency = require(\"./RequireHeaderDependency\");\nconst RequireResolveContextDependency = require(\"./RequireResolveContextDependency\");\nconst RequireResolveDependency = require(\"./RequireResolveDependency\");\nconst RequireResolveHeaderDependency = require(\"./RequireResolveHeaderDependency\");\nconst RuntimeRequirementsDependency = require(\"./RuntimeRequirementsDependency\");\n\nconst CommonJsExportsParserPlugin = require(\"./CommonJsExportsParserPlugin\");\nconst CommonJsImportsParserPlugin = require(\"./CommonJsImportsParserPlugin\");\n\nconst {\n\tJAVASCRIPT_MODULE_TYPE_AUTO,\n\tJAVASCRIPT_MODULE_TYPE_DYNAMIC\n} = require(\"../ModuleTypeConstants\");\nconst {\n\tevaluateToIdentifier,\n\ttoConstantDependency\n} = require(\"../javascript/JavascriptParserHelpers\");\nconst CommonJsExportRequireDependency = require(\"./CommonJsExportRequireDependency\");\n\n/** @typedef {import(\"../../declarations/WebpackOptions\").JavascriptParserOptions} JavascriptParserOptions */\n/** @typedef {import(\"../Compilation\")} Compilation */\n/** @typedef {import(\"../Compiler\")} Compiler */\n/** @typedef {import(\"../Dependency\").DependencyLocation} DependencyLocation */\n/** @typedef {import(\"../Module\").BuildInfo} BuildInfo */\n/** @typedef {import(\"../javascript/JavascriptParser\")} Parser */\n\nconst PLUGIN_NAME = \"CommonJsPlugin\";\n\nclass CommonJsPlugin {\n\t/**\n\t * Apply the plugin\n\t * @param {Compiler} compiler the compiler instance\n\t * @returns {void}\n\t */\n\tapply(compiler) {\n\t\tcompiler.hooks.compilation.tap(\n\t\t\tPLUGIN_NAME,\n\t\t\t(compilation, { contextModuleFactory, normalModuleFactory }) => {\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tCommonJsRequireDependency,\n\t\t\t\t\tnormalModuleFactory\n\t\t\t\t);\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tCommonJsRequireDependency,\n\t\t\t\t\tnew CommonJsRequireDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tCommonJsFullRequireDependency,\n\t\t\t\t\tnormalModuleFactory\n\t\t\t\t);\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tCommonJsFullRequireDependency,\n\t\t\t\t\tnew CommonJsFullRequireDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tCommonJsRequireContextDependency,\n\t\t\t\t\tcontextModuleFactory\n\t\t\t\t);\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tCommonJsRequireContextDependency,\n\t\t\t\t\tnew CommonJsRequireContextDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tRequireResolveDependency,\n\t\t\t\t\tnormalModuleFactory\n\t\t\t\t);\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tRequireResolveDependency,\n\t\t\t\t\tnew RequireResolveDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tRequireResolveContextDependency,\n\t\t\t\t\tcontextModuleFactory\n\t\t\t\t);\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tRequireResolveContextDependency,\n\t\t\t\t\tnew RequireResolveContextDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tRequireResolveHeaderDependency,\n\t\t\t\t\tnew RequireResolveHeaderDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tRequireHeaderDependency,\n\t\t\t\t\tnew RequireHeaderDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tCommonJsExportsDependency,\n\t\t\t\t\tnew CommonJsExportsDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tCommonJsExportRequireDependency,\n\t\t\t\t\tnormalModuleFactory\n\t\t\t\t);\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tCommonJsExportRequireDependency,\n\t\t\t\t\tnew CommonJsExportRequireDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tconst selfFactory = new SelfModuleFactory(compilation.moduleGraph);\n\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tCommonJsSelfReferenceDependency,\n\t\t\t\t\tselfFactory\n\t\t\t\t);\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tCommonJsSelfReferenceDependency,\n\t\t\t\t\tnew CommonJsSelfReferenceDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.dependencyFactories.set(\n\t\t\t\t\tModuleDecoratorDependency,\n\t\t\t\t\tselfFactory\n\t\t\t\t);\n\t\t\t\tcompilation.dependencyTemplates.set(\n\t\t\t\t\tModuleDecoratorDependency,\n\t\t\t\t\tnew ModuleDecoratorDependency.Template()\n\t\t\t\t);\n\n\t\t\t\tcompilation.hooks.runtimeRequirementInModule\n\t\t\t\t\t.for(RuntimeGlobals.harmonyModuleDecorator)\n\t\t\t\t\t.tap(PLUGIN_NAME, (module, set) => {\n\t\t\t\t\t\tset.add(RuntimeGlobals.module);\n\t\t\t\t\t\tset.add(RuntimeGlobals.requireScope);\n\t\t\t\t\t});\n\n\t\t\t\tcompilation.hooks.runtimeRequirementInModule\n\t\t\t\t\t.for(RuntimeGlobals.nodeModuleDecorator)\n\t\t\t\t\t.tap(PLUGIN_NAME, (module, set) => {\n\t\t\t\t\t\tset.add(RuntimeGlobals.module);\n\t\t\t\t\t\tset.add(RuntimeGlobals.requireScope);\n\t\t\t\t\t});\n\n\t\t\t\tcompilation.hooks.runtimeRequirementInTree\n\t\t\t\t\t.for(RuntimeGlobals.harmonyModuleDecorator)\n\t\t\t\t\t.tap(PLUGIN_NAME, (chunk, set) => {\n\t\t\t\t\t\tcompilation.addRuntimeModule(\n\t\t\t\t\t\t\tchunk,\n\t\t\t\t\t\t\tnew HarmonyModuleDecoratorRuntimeModule()\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\n\t\t\t\tcompilation.hooks.runtimeRequirementInTree\n\t\t\t\t\t.for(RuntimeGlobals.nodeModuleDecorator)\n\t\t\t\t\t.tap(PLUGIN_NAME, (chunk, set) => {\n\t\t\t\t\t\tcompilation.addRuntimeModule(\n\t\t\t\t\t\t\tchunk,\n\t\t\t\t\t\t\tnew NodeModuleDecoratorRuntimeModule()\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\n\t\t\t\t/**\n\t\t\t\t * @param {Parser} parser parser parser\n\t\t\t\t * @param {JavascriptParserOptions} parserOptions parserOptions\n\t\t\t\t * @returns {void}\n\t\t\t\t */\n\t\t\t\tconst handler = (parser, parserOptions) => {\n\t\t\t\t\tif (parserOptions.commonjs !== undefined && !parserOptions.commonjs)\n\t\t\t\t\t\treturn;\n\t\t\t\t\tparser.hooks.typeof\n\t\t\t\t\t\t.for(\"module\")\n\t\t\t\t\t\t.tap(\n\t\t\t\t\t\t\tPLUGIN_NAME,\n\t\t\t\t\t\t\ttoConstantDependency(parser, JSON.stringify(\"object\"))\n\t\t\t\t\t\t);\n\n\t\t\t\t\tparser.hooks.expression\n\t\t\t\t\t\t.for(\"require.main\")\n\t\t\t\t\t\t.tap(\n\t\t\t\t\t\t\tPLUGIN_NAME,\n\t\t\t\t\t\t\ttoConstantDependency(\n\t\t\t\t\t\t\t\tparser,\n\t\t\t\t\t\t\t\t`${RuntimeGlobals.moduleCache}[${RuntimeGlobals.entryModuleId}]`,\n\t\t\t\t\t\t\t\t[RuntimeGlobals.moduleCache, RuntimeGlobals.entryModuleId]\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\tparser.hooks.expression\n\t\t\t\t\t\t.for(RuntimeGlobals.moduleLoaded)\n\t\t\t\t\t\t.tap(PLUGIN_NAME, expr => {\n\t\t\t\t\t\t\t/** @type {BuildInfo} */\n\t\t\t\t\t\t\t(parser.state.module.buildInfo).moduleConcatenationBailout =\n\t\t\t\t\t\t\t\tRuntimeGlobals.moduleLoaded;\n\t\t\t\t\t\t\tconst dep = new RuntimeRequirementsDependency([\n\t\t\t\t\t\t\t\tRuntimeGlobals.moduleLoaded\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t\tdep.loc = /** @type {DependencyLocation} */ (expr.loc);\n\t\t\t\t\t\t\tparser.state.module.addPresentationalDependency(dep);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t});\n\n\t\t\t\t\tparser.hooks.expression\n\t\t\t\t\t\t.for(RuntimeGlobals.moduleId)\n\t\t\t\t\t\t.tap(PLUGIN_NAME, expr => {\n\t\t\t\t\t\t\t/** @type {BuildInfo} */\n\t\t\t\t\t\t\t(parser.state.module.buildInfo).moduleConcatenationBailout =\n\t\t\t\t\t\t\t\tRuntimeGlobals.moduleId;\n\t\t\t\t\t\t\tconst dep = new RuntimeRequirementsDependency([\n\t\t\t\t\t\t\t\tRuntimeGlobals.moduleId\n\t\t\t\t\t\t\t]);\n\t\t\t\t\t\t\tdep.loc = /** @type {DependencyLocation} */ (expr.loc);\n\t\t\t\t\t\t\tparser.state.module.addPresentationalDependency(dep);\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t});\n\n\t\t\t\t\tparser.hooks.evaluateIdentifier.for(\"module.hot\").tap(\n\t\t\t\t\t\tPLUGIN_NAME,\n\t\t\t\t\t\tevaluateToIdentifier(\"module.hot\", \"module\", () => [\"hot\"], null)\n\t\t\t\t\t);\n\n\t\t\t\t\tnew CommonJsImportsParserPlugin(parserOptions).apply(parser);\n\t\t\t\t\tnew CommonJsExportsParserPlugin(compilation.moduleGraph).apply(\n\t\t\t\t\t\tparser\n\t\t\t\t\t);\n\t\t\t\t};\n\n\t\t\t\tnormalModuleFactory.hooks.parser\n\t\t\t\t\t.for(JAVASCRIPT_MODULE_TYPE_AUTO)\n\t\t\t\t\t.tap(PLUGIN_NAME, handler);\n\t\t\t\tnormalModuleFactory.hooks.parser\n\t\t\t\t\t.for(JAVASCRIPT_MODULE_TYPE_DYNAMIC)\n\t\t\t\t\t.tap(PLUGIN_NAME, handler);\n\t\t\t}\n\t\t);\n\t}\n}\n\nclass HarmonyModuleDecoratorRuntimeModule extends RuntimeModule {\n\tconstructor() {\n\t\tsuper(\"harmony module decorator\");\n\t}\n\n\t/**\n\t * @returns {string | null} runtime code\n\t */\n\tgenerate() {\n\t\tconst { runtimeTemplate } = /** @type {Compilation} */ (this.compilation);\n\t\treturn Template.asString([\n\t\t\t`${\n\t\t\t\tRuntimeGlobals.harmonyModuleDecorator\n\t\t\t} = ${runtimeTemplate.basicFunction(\"module\", [\n\t\t\t\t\"module = Object.create(module);\",\n\t\t\t\t\"if (!module.children) module.children = [];\",\n\t\t\t\t\"Object.defineProperty(module, 'exports', {\",\n\t\t\t\tTemplate.indent([\n\t\t\t\t\t\"enumerable: true,\",\n\t\t\t\t\t`set: ${runtimeTemplate.basicFunction(\"\", [\n\t\t\t\t\t\t\"throw new Error('ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: ' + module.id);\"\n\t\t\t\t\t])}`\n\t\t\t\t]),\n\t\t\t\t\"});\",\n\t\t\t\t\"return module;\"\n\t\t\t])};`\n\t\t]);\n\t}\n}\n\nclass NodeModuleDecoratorRuntimeModule extends RuntimeModule {\n\tconstructor() {\n\t\tsuper(\"node module decorator\");\n\t}\n\n\t/**\n\t * @returns {string | null} runtime code\n\t */\n\tgenerate() {\n\t\tconst { runtimeTemplate } = /** @type {Compilation} */ (this.compilation);\n\t\treturn Template.asString([\n\t\t\t`${RuntimeGlobals.nodeModuleDecorator} = ${runtimeTemplate.basicFunction(\n\t\t\t\t\"module\",\n\t\t\t\t[\n\t\t\t\t\t\"module.paths = [];\",\n\t\t\t\t\t\"if (!module.children) module.children = [];\",\n\t\t\t\t\t\"return module;\"\n\t\t\t\t]\n\t\t\t)};`\n\t\t]);\n\t}\n}\n\nmodule.exports = CommonJsPlugin;\n"]},"metadata":{},"sourceType":"script"}