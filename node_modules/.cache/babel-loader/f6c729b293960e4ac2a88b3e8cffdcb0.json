{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nconst {\n  JAVASCRIPT_MODULE_TYPE_AUTO,\n  JAVASCRIPT_MODULE_TYPE_DYNAMIC\n} = require(\"./ModuleTypeConstants\");\n\nconst NodeStuffInWebError = require(\"./NodeStuffInWebError\");\n\nconst RuntimeGlobals = require(\"./RuntimeGlobals\");\n\nconst CachedConstDependency = require(\"./dependencies/CachedConstDependency\");\n\nconst ConstDependency = require(\"./dependencies/ConstDependency\");\n\nconst {\n  evaluateToString,\n  expressionIsUnsupported\n} = require(\"./javascript/JavascriptParserHelpers\");\n\nconst {\n  relative\n} = require(\"./util/fs\");\n\nconst {\n  parseResource\n} = require(\"./util/identifier\");\n/** @typedef {import(\"webpack-sources\").ReplaceSource} ReplaceSource */\n\n/** @typedef {import(\"../declarations/WebpackOptions\").JavascriptParserOptions} JavascriptParserOptions */\n\n/** @typedef {import(\"../declarations/WebpackOptions\").NodeOptions} NodeOptions */\n\n/** @typedef {import(\"./Compiler\")} Compiler */\n\n/** @typedef {import(\"./Dependency\")} Dependency */\n\n/** @typedef {import(\"./Dependency\").DependencyLocation} DependencyLocation */\n\n/** @typedef {import(\"./DependencyTemplates\")} DependencyTemplates */\n\n/** @typedef {import(\"./NormalModule\")} NormalModule */\n\n/** @typedef {import(\"./RuntimeTemplate\")} RuntimeTemplate */\n\n/** @typedef {import(\"./javascript/JavascriptParser\")} JavascriptParser */\n\n/** @typedef {import(\"./javascript/JavascriptParser\").Range} Range */\n\n\nconst PLUGIN_NAME = \"NodeStuffPlugin\";\n\nclass NodeStuffPlugin {\n  /**\n   * @param {NodeOptions} options options\n   */\n  constructor(options) {\n    this.options = options;\n  }\n  /**\n   * Apply the plugin\n   * @param {Compiler} compiler the compiler instance\n   * @returns {void}\n   */\n\n\n  apply(compiler) {\n    const options = this.options;\n    compiler.hooks.compilation.tap(PLUGIN_NAME, (compilation, _ref) => {\n      let {\n        normalModuleFactory\n      } = _ref;\n\n      /**\n       * @param {JavascriptParser} parser the parser\n       * @param {JavascriptParserOptions} parserOptions options\n       * @returns {void}\n       */\n      const handler = (parser, parserOptions) => {\n        if (parserOptions.node === false) return;\n        let localOptions = options;\n\n        if (parserOptions.node) {\n          localOptions = { ...localOptions,\n            ...parserOptions.node\n          };\n        }\n\n        if (localOptions.global !== false) {\n          const withWarning = localOptions.global === \"warn\";\n          parser.hooks.expression.for(\"global\").tap(PLUGIN_NAME, expr => {\n            const dep = new ConstDependency(RuntimeGlobals.global,\n            /** @type {Range} */\n            expr.range, [RuntimeGlobals.global]);\n            dep.loc =\n            /** @type {DependencyLocation} */\n            expr.loc;\n            parser.state.module.addPresentationalDependency(dep); // TODO webpack 6 remove\n\n            if (withWarning) {\n              parser.state.module.addWarning(new NodeStuffInWebError(dep.loc, \"global\", \"The global namespace object is a Node.js feature and isn't available in browsers.\"));\n            }\n          });\n          parser.hooks.rename.for(\"global\").tap(PLUGIN_NAME, expr => {\n            const dep = new ConstDependency(RuntimeGlobals.global,\n            /** @type {Range} */\n            expr.range, [RuntimeGlobals.global]);\n            dep.loc =\n            /** @type {DependencyLocation} */\n            expr.loc;\n            parser.state.module.addPresentationalDependency(dep);\n            return false;\n          });\n        }\n        /**\n         * @param {string} expressionName expression name\n         * @param {(module: NormalModule) => string} fn function\n         * @param {string=} warning warning\n         * @returns {void}\n         */\n\n\n        const setModuleConstant = (expressionName, fn, warning) => {\n          parser.hooks.expression.for(expressionName).tap(PLUGIN_NAME, expr => {\n            const dep = new CachedConstDependency(JSON.stringify(fn(parser.state.module)),\n            /** @type {Range} */\n            expr.range, expressionName);\n            dep.loc =\n            /** @type {DependencyLocation} */\n            expr.loc;\n            parser.state.module.addPresentationalDependency(dep); // TODO webpack 6 remove\n\n            if (warning) {\n              parser.state.module.addWarning(new NodeStuffInWebError(dep.loc, expressionName, warning));\n            }\n\n            return true;\n          });\n        };\n        /**\n         * @param {string} expressionName expression name\n         * @param {string} value value\n         * @param {string=} warning warning\n         * @returns {void}\n         */\n\n\n        const setConstant = (expressionName, value, warning) => setModuleConstant(expressionName, () => value, warning);\n\n        const context = compiler.context;\n\n        if (localOptions.__filename) {\n          switch (localOptions.__filename) {\n            case \"mock\":\n              setConstant(\"__filename\", \"/index.js\");\n              break;\n\n            case \"warn-mock\":\n              setConstant(\"__filename\", \"/index.js\", \"__filename is a Node.js feature and isn't available in browsers.\");\n              break;\n\n            case true:\n              setModuleConstant(\"__filename\", module => relative(compiler.inputFileSystem, context, module.resource));\n              break;\n          }\n\n          parser.hooks.evaluateIdentifier.for(\"__filename\").tap(PLUGIN_NAME, expr => {\n            if (!parser.state.module) return;\n            const resource = parseResource(parser.state.module.resource);\n            return evaluateToString(resource.path)(expr);\n          });\n        }\n\n        if (localOptions.__dirname) {\n          switch (localOptions.__dirname) {\n            case \"mock\":\n              setConstant(\"__dirname\", \"/\");\n              break;\n\n            case \"warn-mock\":\n              setConstant(\"__dirname\", \"/\", \"__dirname is a Node.js feature and isn't available in browsers.\");\n              break;\n\n            case true:\n              setModuleConstant(\"__dirname\", module => relative(compiler.inputFileSystem, context, module.context));\n              break;\n          }\n\n          parser.hooks.evaluateIdentifier.for(\"__dirname\").tap(PLUGIN_NAME, expr => {\n            if (!parser.state.module) return;\n            return evaluateToString(parser.state.module.context)(expr);\n          });\n        }\n\n        parser.hooks.expression.for(\"require.extensions\").tap(PLUGIN_NAME, expressionIsUnsupported(parser, \"require.extensions is not supported by webpack. Use a loader instead.\"));\n      };\n\n      normalModuleFactory.hooks.parser.for(JAVASCRIPT_MODULE_TYPE_AUTO).tap(PLUGIN_NAME, handler);\n      normalModuleFactory.hooks.parser.for(JAVASCRIPT_MODULE_TYPE_DYNAMIC).tap(PLUGIN_NAME, handler);\n    });\n  }\n\n}\n\nmodule.exports = NodeStuffPlugin;","map":{"version":3,"sources":["/Users/zachjohnson/Desktop/ChatNYT/node_modules/webpack/lib/NodeStuffPlugin.js"],"names":["JAVASCRIPT_MODULE_TYPE_AUTO","JAVASCRIPT_MODULE_TYPE_DYNAMIC","require","NodeStuffInWebError","RuntimeGlobals","CachedConstDependency","ConstDependency","evaluateToString","expressionIsUnsupported","relative","parseResource","PLUGIN_NAME","NodeStuffPlugin","constructor","options","apply","compiler","hooks","compilation","tap","normalModuleFactory","handler","parser","parserOptions","node","localOptions","global","withWarning","expression","for","expr","dep","range","loc","state","module","addPresentationalDependency","addWarning","rename","setModuleConstant","expressionName","fn","warning","JSON","stringify","setConstant","value","context","__filename","inputFileSystem","resource","evaluateIdentifier","path","__dirname","exports"],"mappings":"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","sourcesContent":["/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\n\"use strict\";\n\nconst {\n\tJAVASCRIPT_MODULE_TYPE_AUTO,\n\tJAVASCRIPT_MODULE_TYPE_DYNAMIC\n} = require(\"./ModuleTypeConstants\");\nconst NodeStuffInWebError = require(\"./NodeStuffInWebError\");\nconst RuntimeGlobals = require(\"./RuntimeGlobals\");\nconst CachedConstDependency = require(\"./dependencies/CachedConstDependency\");\nconst ConstDependency = require(\"./dependencies/ConstDependency\");\nconst {\n\tevaluateToString,\n\texpressionIsUnsupported\n} = require(\"./javascript/JavascriptParserHelpers\");\nconst { relative } = require(\"./util/fs\");\nconst { parseResource } = require(\"./util/identifier\");\n\n/** @typedef {import(\"webpack-sources\").ReplaceSource} ReplaceSource */\n/** @typedef {import(\"../declarations/WebpackOptions\").JavascriptParserOptions} JavascriptParserOptions */\n/** @typedef {import(\"../declarations/WebpackOptions\").NodeOptions} NodeOptions */\n/** @typedef {import(\"./Compiler\")} Compiler */\n/** @typedef {import(\"./Dependency\")} Dependency */\n/** @typedef {import(\"./Dependency\").DependencyLocation} DependencyLocation */\n/** @typedef {import(\"./DependencyTemplates\")} DependencyTemplates */\n/** @typedef {import(\"./NormalModule\")} NormalModule */\n/** @typedef {import(\"./RuntimeTemplate\")} RuntimeTemplate */\n/** @typedef {import(\"./javascript/JavascriptParser\")} JavascriptParser */\n/** @typedef {import(\"./javascript/JavascriptParser\").Range} Range */\n\nconst PLUGIN_NAME = \"NodeStuffPlugin\";\n\nclass NodeStuffPlugin {\n\t/**\n\t * @param {NodeOptions} options options\n\t */\n\tconstructor(options) {\n\t\tthis.options = options;\n\t}\n\n\t/**\n\t * Apply the plugin\n\t * @param {Compiler} compiler the compiler instance\n\t * @returns {void}\n\t */\n\tapply(compiler) {\n\t\tconst options = this.options;\n\t\tcompiler.hooks.compilation.tap(\n\t\t\tPLUGIN_NAME,\n\t\t\t(compilation, { normalModuleFactory }) => {\n\t\t\t\t/**\n\t\t\t\t * @param {JavascriptParser} parser the parser\n\t\t\t\t * @param {JavascriptParserOptions} parserOptions options\n\t\t\t\t * @returns {void}\n\t\t\t\t */\n\t\t\t\tconst handler = (parser, parserOptions) => {\n\t\t\t\t\tif (parserOptions.node === false) return;\n\n\t\t\t\t\tlet localOptions = options;\n\t\t\t\t\tif (parserOptions.node) {\n\t\t\t\t\t\tlocalOptions = { ...localOptions, ...parserOptions.node };\n\t\t\t\t\t}\n\n\t\t\t\t\tif (localOptions.global !== false) {\n\t\t\t\t\t\tconst withWarning = localOptions.global === \"warn\";\n\t\t\t\t\t\tparser.hooks.expression.for(\"global\").tap(PLUGIN_NAME, expr => {\n\t\t\t\t\t\t\tconst dep = new ConstDependency(\n\t\t\t\t\t\t\t\tRuntimeGlobals.global,\n\t\t\t\t\t\t\t\t/** @type {Range} */ (expr.range),\n\t\t\t\t\t\t\t\t[RuntimeGlobals.global]\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tdep.loc = /** @type {DependencyLocation} */ (expr.loc);\n\t\t\t\t\t\t\tparser.state.module.addPresentationalDependency(dep);\n\n\t\t\t\t\t\t\t// TODO webpack 6 remove\n\t\t\t\t\t\t\tif (withWarning) {\n\t\t\t\t\t\t\t\tparser.state.module.addWarning(\n\t\t\t\t\t\t\t\t\tnew NodeStuffInWebError(\n\t\t\t\t\t\t\t\t\t\tdep.loc,\n\t\t\t\t\t\t\t\t\t\t\"global\",\n\t\t\t\t\t\t\t\t\t\t\"The global namespace object is a Node.js feature and isn't available in browsers.\"\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tparser.hooks.rename.for(\"global\").tap(PLUGIN_NAME, expr => {\n\t\t\t\t\t\t\tconst dep = new ConstDependency(\n\t\t\t\t\t\t\t\tRuntimeGlobals.global,\n\t\t\t\t\t\t\t\t/** @type {Range} */ (expr.range),\n\t\t\t\t\t\t\t\t[RuntimeGlobals.global]\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tdep.loc = /** @type {DependencyLocation} */ (expr.loc);\n\t\t\t\t\t\t\tparser.state.module.addPresentationalDependency(dep);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t/**\n\t\t\t\t\t * @param {string} expressionName expression name\n\t\t\t\t\t * @param {(module: NormalModule) => string} fn function\n\t\t\t\t\t * @param {string=} warning warning\n\t\t\t\t\t * @returns {void}\n\t\t\t\t\t */\n\t\t\t\t\tconst setModuleConstant = (expressionName, fn, warning) => {\n\t\t\t\t\t\tparser.hooks.expression\n\t\t\t\t\t\t\t.for(expressionName)\n\t\t\t\t\t\t\t.tap(PLUGIN_NAME, expr => {\n\t\t\t\t\t\t\t\tconst dep = new CachedConstDependency(\n\t\t\t\t\t\t\t\t\tJSON.stringify(fn(parser.state.module)),\n\t\t\t\t\t\t\t\t\t/** @type {Range} */ (expr.range),\n\t\t\t\t\t\t\t\t\texpressionName\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tdep.loc = /** @type {DependencyLocation} */ (expr.loc);\n\t\t\t\t\t\t\t\tparser.state.module.addPresentationalDependency(dep);\n\n\t\t\t\t\t\t\t\t// TODO webpack 6 remove\n\t\t\t\t\t\t\t\tif (warning) {\n\t\t\t\t\t\t\t\t\tparser.state.module.addWarning(\n\t\t\t\t\t\t\t\t\t\tnew NodeStuffInWebError(dep.loc, expressionName, warning)\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t};\n\n\t\t\t\t\t/**\n\t\t\t\t\t * @param {string} expressionName expression name\n\t\t\t\t\t * @param {string} value value\n\t\t\t\t\t * @param {string=} warning warning\n\t\t\t\t\t * @returns {void}\n\t\t\t\t\t */\n\t\t\t\t\tconst setConstant = (expressionName, value, warning) =>\n\t\t\t\t\t\tsetModuleConstant(expressionName, () => value, warning);\n\n\t\t\t\t\tconst context = compiler.context;\n\t\t\t\t\tif (localOptions.__filename) {\n\t\t\t\t\t\tswitch (localOptions.__filename) {\n\t\t\t\t\t\t\tcase \"mock\":\n\t\t\t\t\t\t\t\tsetConstant(\"__filename\", \"/index.js\");\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase \"warn-mock\":\n\t\t\t\t\t\t\t\tsetConstant(\n\t\t\t\t\t\t\t\t\t\"__filename\",\n\t\t\t\t\t\t\t\t\t\"/index.js\",\n\t\t\t\t\t\t\t\t\t\"__filename is a Node.js feature and isn't available in browsers.\"\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase true:\n\t\t\t\t\t\t\t\tsetModuleConstant(\"__filename\", module =>\n\t\t\t\t\t\t\t\t\trelative(compiler.inputFileSystem, context, module.resource)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tparser.hooks.evaluateIdentifier\n\t\t\t\t\t\t\t.for(\"__filename\")\n\t\t\t\t\t\t\t.tap(PLUGIN_NAME, expr => {\n\t\t\t\t\t\t\t\tif (!parser.state.module) return;\n\t\t\t\t\t\t\t\tconst resource = parseResource(parser.state.module.resource);\n\t\t\t\t\t\t\t\treturn evaluateToString(resource.path)(expr);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (localOptions.__dirname) {\n\t\t\t\t\t\tswitch (localOptions.__dirname) {\n\t\t\t\t\t\t\tcase \"mock\":\n\t\t\t\t\t\t\t\tsetConstant(\"__dirname\", \"/\");\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase \"warn-mock\":\n\t\t\t\t\t\t\t\tsetConstant(\n\t\t\t\t\t\t\t\t\t\"__dirname\",\n\t\t\t\t\t\t\t\t\t\"/\",\n\t\t\t\t\t\t\t\t\t\"__dirname is a Node.js feature and isn't available in browsers.\"\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase true:\n\t\t\t\t\t\t\t\tsetModuleConstant(\"__dirname\", module =>\n\t\t\t\t\t\t\t\t\trelative(compiler.inputFileSystem, context, module.context)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tparser.hooks.evaluateIdentifier\n\t\t\t\t\t\t\t.for(\"__dirname\")\n\t\t\t\t\t\t\t.tap(PLUGIN_NAME, expr => {\n\t\t\t\t\t\t\t\tif (!parser.state.module) return;\n\t\t\t\t\t\t\t\treturn evaluateToString(parser.state.module.context)(expr);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tparser.hooks.expression\n\t\t\t\t\t\t.for(\"require.extensions\")\n\t\t\t\t\t\t.tap(\n\t\t\t\t\t\t\tPLUGIN_NAME,\n\t\t\t\t\t\t\texpressionIsUnsupported(\n\t\t\t\t\t\t\t\tparser,\n\t\t\t\t\t\t\t\t\"require.extensions is not supported by webpack. Use a loader instead.\"\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t};\n\n\t\t\t\tnormalModuleFactory.hooks.parser\n\t\t\t\t\t.for(JAVASCRIPT_MODULE_TYPE_AUTO)\n\t\t\t\t\t.tap(PLUGIN_NAME, handler);\n\t\t\t\tnormalModuleFactory.hooks.parser\n\t\t\t\t\t.for(JAVASCRIPT_MODULE_TYPE_DYNAMIC)\n\t\t\t\t\t.tap(PLUGIN_NAME, handler);\n\t\t\t}\n\t\t);\n\t}\n}\n\nmodule.exports = NodeStuffPlugin;\n"]},"metadata":{},"sourceType":"script"}